version: 2.1

commands:
  action:
    parameters:
      uses:
        type: string
      with:
        type: string
    steps:
      - run:
          name: << parameters.uses >>
          command: |
            # Download lights-camera-action binary
            lca_dir=/tmp/gh-actions-orb/v0.0.3
            lca=$lca_dir/lights-camera-action
            mkdir -p $lca_dir
            if [[ -f $lca ]]; then
              echo "lights-camera-action already exists"
            elif uname -a | grep Linux | grep x86_64 > /dev/null 2>&1 ; then
              export PATH=$PATH:$lca_dir
              curl -q -L -o $lca https://github.com/aengelberg/lights-camera-action/releases/download/v0.0.3/lights-camera-action-linux-amd64
              chmod 755 $lca
            elif uname -a | grep Darwin > /dev/null 2>&1; then
              export PATH=$PATH:$lca_dir
              curl -q -L -o $lca https://github.com/aengelberg/lights-camera-action/releases/download/v0.0.3/lights-camera-action-darwin-amd64
              chmod 755 $lca
            fi
            # Create a YAML file of parameters
            cat \<<EOF  > with.yml
            << parameters.with >>
            EOF
            # Run the action
            lights-camera-action << parameters.uses >> with.yml

jobs:
  run-hello-world:
    machine:
      image: ubuntu-1604:201903-01
    steps:
      - action:
          uses: actions/hello-world-docker-action@v1
          with: |
            who-to-greet: 'Mona The Octocat'

workflows:
  test:
    jobs:
      - run-hello-world